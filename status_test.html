<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>3D坦克服务器状态页面</title>
</head>
<body>

  <h1><strong><span style="font-size:18px;">国服</span></strong></h1>
  
  <p>在线：<span id="onlineCount"></span></p>
  <p>战斗中：<span id="inbattlesCount"></span></p>
  <p>4399：<span id="my4399ComCount"></span></p>
  <p><br /></p>
  
  <p id="updateStatus">预更新：</p>

  <script>
    function fetchBalancerStats() {
      fetch('https://balancer.3dtank.com/balancer')
        .then(response => response.json())
        .then(data => {
          let totalInbattles = 0;
          let totalOnline = 0;
          let totalMy4399Com = 0;
          Object.values(data.nodes).forEach(node => {
            totalInbattles += node.inbattles || 0;
            totalOnline += node.online || 0;
            totalMy4399Com += node.partners && node.partners.my_4399_com ? node.partners.my_4399_com : 0;
          });
          const my4399ComCount = totalMy4399Com || 0;
          document.getElementById('inbattlesCount').innerText = totalInbattles;
          document.getElementById('onlineCount').innerText = totalOnline;
          document.getElementById('my4399ComCount').innerText = my4399ComCount;
        })
        .catch(error => console.error('获取数据时出错：', error));
    }

    function checkUpdateStatus() {
      fetch('https://c3.3dtank.com/stage-balancer')
        .then(response => response.status === 502 ? '否' : response.json())
        .then(data => {
          const hasC3Node = data && data.nodes && data.nodes['cn-stage-game.c3'];
          const updateStatus = hasC3Node ? '是' : '否';
          document.getElementById('updateStatus').innerText = `预更新：${updateStatus}`;
        })
        .catch(error => {
          console.error('获取预更新状态时出错：', error);
          document.getElementById('updateStatus').innerText = '预更新：否';
        });
    }

    // 初始获取
    fetchBalancerStats();
    checkUpdateStatus();
  </script>

</body>
</html>
