<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>3D坦克游戏内物品名称翻译</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;500;700&display=swap" />
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+1p&display=swap" rel="stylesheet" />
    <style>
        /* ... 你的 CSS 样式保持不变 ... */
        * {
            -webkit-tap-highlight-color: transparent;
            }
        * {
        font-family: 'Rubik', 'M PLUS 1p';
        }
                body {
                    margin: 0;
                    padding: 0;
                    background-color: #001926;
                    color: white;
                }
                header {
                    background-color: #001926;
                    color: white;
                    padding: 15px;
                    text-align: center;
                }
                section {
                    max-width: 800px;
                    margin: 20px auto;
                    background-color: #001926;
                    color: white;
                    padding: 20px;
                    border-radius: 5px;
                    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
                }
                label {
                    display: block;
                    margin-bottom: 8px;
                }
                textarea {
                    width: 100%;
                    height: 200px;
                    padding: 8px;
                    margin-bottom: 12px;
                    box-sizing: border-box;
                    border: 1px solid #bfd5ff;
                    border-radius: 4px;
                    resize: none;
                    background-color: #001926;
                    color: white;
                }
                button {
                    background-color: #76FF33;
                    color: white;
                    padding: 10px 15px;
                    border: none;
                    border-radius: 25px;
                    cursor: pointer;
                    margin-right: 10px;
                    font-size: 16px;
                }
                button:hover {
                    background-color: #65e32b;
                }
                #customNotification {
                    display: none;
                    position: fixed;
                    top: 10px;
                    left: 50%;
                    transform: translateX(-50%);
                    background-color: #76FF33;
                    color: white;
                    padding: 15px;
                    border-radius: 5px;
                    z-index: 1;
                }
                #outputBox {
                    width: 100%;
                    height: 200px;
                    margin-bottom: 10px;
                    padding: 10px;
                    border: 1px solid #bfd5ff;
                    border-radius: 5px;
                    overflow-y: auto;
                    font-size: 14px;
                    background-color: #001926;
                    color: white;
                }
                footer {
                    text-align: center;
                    padding: 10px;
                    color: #ccc;
                }
            </style>
</head>
<body>
    <header>
        <h1>3D坦克翻译器（完善中）</h1>
    </header>
    <section>
        <p>目前只支持翻译游戏物品名称，不支持翻译整句话。</p>
        <label for="inputText">输入文本：</label>
        <textarea id="inputText" oninput="replaceAndDisplay()"></textarea>
        <button onclick="copyResult()"><span style="color:#000000;">复制结果</span></button>
        <label for="fileName">文件名（可选）：</label>
        <input type="text" id="fileName" placeholder="输入文件名" />
        <button onclick="saveToFile()"><span style="color:#000000;">保存到文件</span></button>
    </section>
    <section>
        <label for="outputBox">替换后的文本：</label>
        <textarea id="outputBox" readonly="readonly"></textarea>
    </section>
    <footer>
        <div id="customNotification">文本已成功复制到剪贴板！</div>
    </footer>

    <!-- 首先加载包含 replacementDict 的脚本 -->
    <script src="translations.js"></script>

    <!-- 然后加载使用 replacementDict 的脚本 -->
    <script>
        // 注意：这里不再需要定义 replacementDict 了！
        // 它已经通过 dictionary.js 加载到全局作用域（或脚本作用域）中了

        function showNotification() {
            const notification = document.getElementById('customNotification');
            notification.style.display = 'block';
            setTimeout(() => {
                notification.style.display = 'none';
            }, 2000);
        }

        function replaceAndDisplay() {
            let userInput = document.getElementById('inputText').value;
            // 直接使用来自 dictionary.js 的 replacementDict
            for (const [key, value] of Object.entries(replacementDict)) {
                // 使用 \b 来匹配单词边界，防止替换单词的一部分
                // 使用 'gi' 标志进行全局、不区分大小写的替换
                let regex = new RegExp(`\\b${key}\\b`, 'gi');
                userInput = userInput.replace(regex, value);
            }
            document.getElementById('outputBox').value = userInput;
        }

        function copyResult() {
            const outputBox = document.getElementById('outputBox');
            outputBox.select();
            // 为了更好的兼容性，可以尝试 navigator.clipboard.writeText
            try {
                navigator.clipboard.writeText(outputBox.value).then(() => {
                    showNotification();
                }).catch(err => {
                    console.error('无法使用 Clipboard API 复制: ', err);
                    // 回退到 document.execCommand
                    fallbackCopyTextToClipboard(outputBox);
                });
            } catch (err) {
                 console.error('Clipboard API 不可用，回退到 execCommand: ', err);
                 fallbackCopyTextToClipboard(outputBox);
            }
        }

        function fallbackCopyTextToClipboard(element) {
            element.select();
             try {
                 var successful = document.execCommand('copy');
                 if (successful) {
                     showNotification();
                 } else {
                     console.error('使用 execCommand 复制失败');
                     alert('复制失败，请手动复制。');
                 }
             } catch (err) {
                 console.error('使用 execCommand 复制时出错: ', err);
                 alert('复制出错，请手动复制。');
             }
             // 取消选择，避免页面上有选中的文本
             window.getSelection().removeAllRanges();
        }


        function saveToFile() {
            let fileNameInput = document.getElementById('fileName');
            let fileName = fileNameInput.value.trim() || 'output.txt';
            // 简单的文件名验证和清理，防止路径遍历等问题
            fileName = fileName.replace(/[^a-zA-Z0-9._-]/g, '_'); // 只允许字母、数字、点、下划线、连字符
            if (!fileName.endsWith('.txt')) {
                fileName += '.txt'; // 确保是 .txt 文件
            }

            let resultText = document.getElementById('outputBox').value;
            const blob = new Blob([resultText], { type: 'text/plain;charset=utf-8' }); // 指定 UTF-8 编码
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = fileName;

            // 模拟点击下载链接
            document.body.appendChild(link); // 需要将 link 添加到 DOM 中才能在 Firefox 中工作
            link.click();
            document.body.removeChild(link); // 点击后移除

            // 可选：下载后清空文件名输入框
            // fileNameInput.value = '';
        }

        // 页面加载时执行一次，以处理可能预先填入的文本
        // 或者根据需要决定是否需要此行为
        // replaceAndDisplay();

    </script>
</body>
</html>
