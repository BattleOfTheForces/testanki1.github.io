<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D坦克字母表游戏</title>
    <style>
        /* (你的 CSS 样式，确保使用中文字体) */
        @import url('https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;500;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=M+PLUS+1p&display=swap');

        * {
            -webkit-tap-highlight-color: transparent;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: #001926;
            color: white;
            font-family: 'Rubik', 'M PLUS 1p';
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            padding: 20px;
            text-align: center;
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 20px;
        }

        /* Tab Styles */
        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            width: 100%;
        }

        .tab {
            padding: 10px 20px;
            margin: 0 10px;
            cursor: pointer;
            font-size: 1.2rem;
            background-color: #00303b;
            color: white;
            border: 2px solid #00303b;
            border-radius: 8px;
        }

        .tab:hover {
            background-color: #64e629;
        }

        .tab.active {
            background-color: #76FF33;
            color: #001926;
            border-color: #76FF33;
        }

        /* Section Styles */
        .section {
            display: none;
            width: 100%;
            max-width: 600px;
            margin-top: 20px;
        }

        .section.active {
            display: block;
        }

        label {
            font-size: 1.1rem;
            margin-bottom: 5px;
        }

        input, button, select {
            padding: 12px;
            margin: 10px 0;
            font-size: 1rem;
            border-radius: 8px;
            border: 2px solid #76FF33;
            background-color: #002b36;
            color: white;
            transition: all 0.3s ease;
        }

        input {
            width: 100%;
            max-width: 320px;
        }
        select{
             width: 100%;
            max-width: 320px;
        }

        input:focus, select:focus {
            border-color: #64e629;
            outline: none;
            box-shadow: 0 0 8px rgba(103, 255, 51, 0.5);
        }

        button {
            background-color: #76FF33;
            color: #001926;
            cursor: pointer;
            font-weight: bold;
        }

        button:hover {
            background-color: #64e629;
        }

        .result {
            color: #76FF33;
            font-weight: bold;
            font-size: 1.5rem;
            margin-top: 20px;
        }

        .error {
            color: red;
            font-size: 1.2rem;
            margin-top: 20px;
        }

        .results-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .result p {
            margin: 10px 0;
        }

        .reproduce-section {
            background-color: #002b36;
            color: #76FF33;
            padding: 20px;
            border-radius: 8px;
            font-size: 1.2rem;
            text-align: left;
        }

        #lettersList button {
            margin: 5px;
            padding: 10px;
            background-color: #00303b;
            color: white;
            border: 2px solid #00303b;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
        }

        #lettersList button:hover {
            background-color: #BFD5FF;
        }

        #lettersList button:disabled {
            background-color: #444;
            cursor: not-allowed;
        }

        #wordDisplay {
            font-size: 1.5rem;
            letter-spacing: 10px;
            margin-top: 20px;
            font-weight: bold;
        }

        #attempts {
            font-size: 1.2rem;
            font-weight: bold;
        }

        #lettersList {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 10px;
            justify-items: center;
        }
        .wordlist-select-container{
            display:flex;
            flex-direction: column;
            align-items: center;
        }

    </style>
</head>
<body>

    <h1>3D坦克字母表游戏</h1>

    <!-- 标签页 -->
    <div class="tabs">
        <div class="tab active" id="puzzleTab" onclick="switchTab('puzzle')">单词解谜</div>
        <div class="tab" id="reproduceTab" onclick="switchTab('reproduce')">游戏再现</div>
    </div>

    <!-- 解谜部分 -->
    <div class="section active" id="puzzleSection">
        <div class="wordlist-select-container">
            <label for="wordlistSelect">选择词库：</label>
            <select id="wordlistSelect">
                <option value="https://testanki1.github.io/alphabet/words.txt">词库 1</option>
                <option value="https://testanki1.github.io/alphabet/words_2.txt">词库 2</option>
            </select>
       </div>
        <label for="length">请输入单词的长度：</label>
        <input type="number" id="length" placeholder="单词长度" min="1">
        </br>
        <label for="letters">请输入该单词中可能含有的字母：</label>
        <input type="text" id="letters" placeholder="字母输入">
        </br>
        <button onclick="solvePuzzle()">解谜！</button>

        <div id="result" class="results-container"></div>
    </div>

    <!-- 游戏再现部分 -->
    <div class="section" id="reproduceSection">
      <div class="wordlist-select-container">
            <label for="wordlistSelectReproduce">选择词库：</label>
            <select id="wordlistSelectReproduce">
                <option value="https://testanki1.github.io/alphabet/words.txt">词库 1</option>
                <option value="https://testanki1.github.io/alphabet/words_2.txt">词库 2</option>
            </select>
        </div>
        <div class="reproduce-section">
            <h3>游戏再现</h3>
            <p>选择字母并猜出单词！</p>
            <div id="letterContainer">
                <p>字母选择：</p>
                <div id="lettersList"></div>
            </div>
            <div id="wordDisplay"></div>
            <p id="guessResult"></p>
            <p>选择次数：<span id="attempts">0</span></p>
            <button onclick="startGame()">开始新游戏</button>
        </div>
    </div>

    <script>
        let targetWord = '';
        let wordLength = 0;
        let guessedLetters = [];
        let attempts = 0;
        let usedLetters = [];
        const lettersListDiv = document.getElementById('lettersList');
        const wordDisplayDiv = document.getElementById('wordDisplay');
        const attemptsSpan = document.getElementById('attempts');
        const guessResult = document.getElementById('guessResult');

        // Input validation for letters
        document.getElementById('letters').addEventListener('input', function (e) {
            const inputValue = this.value.toUpperCase();
            this.value = inputValue.split('').filter((letter, index, self) => self.indexOf(letter) === index).join('');
            this.value = this.value.replace(/[^A-Za-z]/g, '');
        });

       // 异步获取单词列表的函数
        async function fetchWords(wordFileURL) { // 现在接受 URL
            try {
                const response = await fetch(wordFileURL); // 使用 URL
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const text = await response.text();
                return text.split('\n').map(word => word.trim()).filter(word => word.length > 0);
            } catch (error) {
                console.error("Could not fetch words:", error);
                document.getElementById('result').innerHTML = `<p class="error">无法加载词库: ${error.message}</p>`;
                return [];
            }
        }


        // 解谜函数
        async function solvePuzzle() {
            const wordLength = parseInt(document.getElementById('length').value);
            const lettersInput = document.getElementById('letters').value.trim().toLowerCase();
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '';

            if (!wordLength || !lettersInput) {
                resultDiv.innerHTML = '<p class="error">请确保输入了单词长度和字母。</p>';
                return;
            }

            try {
                // 获取选中的词库
                const wordlistSelect = document.getElementById('wordlistSelect');
                const selectedWordFileURL = wordlistSelect.value; // 获取 URL
                const words = await fetchWords(selectedWordFileURL);

                // 将输入的字母转换为集合
                const lettersSet = new Set(lettersInput.split(''));

                // 筛选符合条件的单词
                const matchingWords = words.filter(word => {
                    if (word.length !== wordLength) return false;
                    return [...word.toLowerCase()].every(char => lettersSet.has(char));
                });

                if (matchingWords.length > 0) {
                    resultDiv.innerHTML = '<h3>符合条件的单词：</h3>';
                    matchingWords.forEach(word => {
                        const wordElement = document.createElement('p');
                        wordElement.classList.add('result');
                        wordElement.textContent = word;
                        resultDiv.appendChild(wordElement);
                    });
                } else {
                    resultDiv.innerHTML = '<p class="error">没有找到符合条件的单词。</p>';
                }
            } catch (error) {
                resultDiv.innerHTML = '<p class="error">获取单词列表时出错，请稍后再试。</p>';
                console.error(error);
            }
        }

        // 随机选择单词
        function chooseRandomWord(words) {
              if (words.length === 0) {
                    wordDisplayDiv.innerHTML = "词库为空，请选择其他词库。";
                    disableAllButtons();
                    return;
              }
            const randomWord = words[Math.floor(Math.random() * words.length)].toUpperCase();
            targetWord = randomWord;
            wordLength = randomWord.length;
            guessedLetters = new Array(wordLength).fill('_');
            updateWordDisplay();
            usedLetters = [];
        }

        // 更新单词显示
        function updateWordDisplay() {
            wordDisplayDiv.innerHTML = guessedLetters.join(' ');
        }

 // 开始新游戏
        function startGame() {
              const wordlistSelect = document.getElementById('wordlistSelectReproduce');
              const selectedWordFileURL = wordlistSelect.value; // 获取 URL

            fetchWords(selectedWordFileURL).then(words => { // 传递 URL
                chooseRandomWord(words);
                attempts = 0;
                attemptsSpan.textContent = attempts;
                guessResult.textContent = '';
                setupLetterButtons();
            });
        }

        // 设置字母选择按钮
        function setupLetterButtons() {
             const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            const targetLetters = Array.from(new Set(targetWord.split('')));
            const remainingLetters = letters.split('').filter(letter => !targetLetters.includes(letter));

            const randomLetters = [];
            while (randomLetters.length < 16 - targetLetters.length) {
                const randomIndex = Math.floor(Math.random() * remainingLetters.length);
                randomLetters.push(remainingLetters[randomIndex]);
                remainingLetters.splice(randomIndex, 1);
            }

            const allLetters = [...targetLetters, ...randomLetters];
            allLetters.sort();


            lettersListDiv.innerHTML = '';
            allLetters.forEach(letter => {
                const button = document.createElement('button');
                button.textContent = letter;
                button.onclick = () => handleLetterClick(button, letter);
                lettersListDiv.appendChild(button);
            });
        }

        // 处理字母点击
       function handleLetterClick(button, letter) {
            if (button.disabled || usedLetters.includes(letter)) return;

            let correctGuess = false;
            for (let i = 0; i < targetWord.length; i++) {
                if (targetWord[i] === letter) {
                    guessedLetters[i] = letter;
                    correctGuess = true;
                }
            }

            updateWordDisplay();
            attempts++;
            attemptsSpan.textContent = attempts;
            usedLetters.push(letter);

            if (correctGuess) {
                guessResult.textContent = '正确！';
                button.style.backgroundColor = '#76FF33';
            } else {
                guessResult.textContent = '错误！';
                button.style.backgroundColor = '#FF6666';
            }
             button.disabled = true;


            if (!guessedLetters.includes('_')) {
                guessResult.textContent = '恭喜你，猜对了！';
                disableAllButtons();
            }
        }

        // 禁用所有字母按钮
        function disableAllButtons() {
            const allButtons = document.querySelectorAll('#lettersList button');
            allButtons.forEach(button => {
                button.disabled = true;
            });
        }

        // 切换标签页
        function switchTab(tab) {
            const puzzleTab = document.getElementById('puzzleTab');
            const reproduceTab = document.getElementById('reproduceTab');
            const puzzleSection = document.getElementById('puzzleSection');
            const reproduceSection = document.getElementById('reproduceSection');

            puzzleTab.classList.remove('active');
            reproduceTab.classList.remove('active');
            puzzleSection.classList.remove('active');
            reproduceSection.classList.remove('active');

            if (tab === 'puzzle') {
                puzzleTab.classList.add('active');
                puzzleSection.classList.add('active');
            } else {
                reproduceTab.classList.add('active');
                reproduceSection.classList.add('active');
                startGame();
            }
        }
    </script>

</body>
</html>
