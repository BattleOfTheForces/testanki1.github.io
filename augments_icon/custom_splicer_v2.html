<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;500;700&display=swap" rel="stylesheet" />
<link href="https://fonts.googleapis.com/css2?family=M+PLUS+1p&display=swap" rel="stylesheet" />
<title>
	3D坦克装备改造图标自定义拼接器
</title>
<style>
* {
    font-family: 'Rubik', 'M PLUS 1p';
}
body {
    background-color: #001926;
    color: white;
    text-align: center;
    margin: 0;
    padding: 0;
}
#svgContainer {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-top: 50px;
}
#loading {
    display: none;
    color: white;
    margin-top: 20px;
}
button {
    background-color: #76FF33;
    color: #001926;
    border: none;
    padding: 10px 20px;
    font-size: 16px;
    cursor: pointer;
    transition: background-color 0.3s;
    margin-bottom: 20px;
    border-radius: 50px;
}
button:hover {
    background-color: #4CAF50;
}
#downloadBtn {
    background-color: #76FF33;
    color: black;
    border: none;
    padding: 10px 20px;
    font-size: 16px;
    cursor: pointer;
    transition: background-color 0.3s;
    text-decoration: none;
    border-radius: 50px;
}
#downloadBtn:hover {
    background-color: #4CAF50;
}
a {
    color: inherit;
    text-decoration: none;
}
#progress {
    width: 80%;
    height: 20px;
    margin-top: 20px;
    background-color: #ddd;
    border-radius: 10px;
    overflow: hidden;
}
#progress-bar {
    height: 100%;
    width: 0%;
    background-color: #76FF33;
}
</style>
<h1>
	3D坦克装备改造图标自定义拼接器
</h1>
<div id="svgContainer">
	<button onclick="generateAllCombinations()">生成所有组合</button> 
	<div id="loading">
		生成中，请稍候...
	</div>
	<div id="progress">
		<div id="progress-bar"></div>
	</div>
	<div id="downloadBtn">
	</div>
</div>
<p style="color:white;margin-top:50px;">
	注：生成的图标仅供参考
</p>
<script>
// 数据
var groupedEquipments = {
            "炮塔": ["滑膛炮", "冰风暴", "火焰炮", "蝎子", "镭射炮", "火龙珠", "激光炮", "磁力炮", "雷暴炮", "火箭炮", "轰天炮", "极速炮", "离子炮", "马格南", "电磁炮", "特斯拉"]
        };
        // 分组后的改造列表
        var groupedAugments = {
            "炮塔": ["空（炮塔）", "肾上腺素", "螺线管冷却", "拖延协议", "加速协议", "负能量场", "震动冻结", "入侵瞄准处理器", "射击速度调节器", "干扰弹", "更快速的水平跟踪", "橡胶炮弹", "轻型电容器", "重型电容器", "治疗发射器", "纳米反应器", "支援纳米机器人", "宽带纳米发射器", "吸血鬼纳米机器人", "精确瞄准系统", "超累积炮弹", "突击弹药", "穿甲弹", "燃烧弹", "分类弹药", "自动加农炮", "高容量弹鼓", "电子偶", "重炮手", "大口径短炮", "自适应重载（1）", "自适应重载（2）", "导弹发射器“旋风”", "远程火箭炸药", "鱼叉导弹", "加强炮架", "自动火药装载机", "电磁脉冲炮弹", "迫击炮", "导弹发射器“镭射”", "负场稳定", "等离子焰炬", "狂暴", "赫利俄斯", "精确弹药装载", "等离子体加速器", "重型等离子炮", "稳定等离子体", "等离子涡轮加速器", "腐蚀混合物", "等离子发生器", "紧凑型坦克", "高压泵", "脉冲星", "电磁加速器“侦察机”", "超空间炮弹", "爆炸弹头", "爆炸弹", "眩晕弹", "冷冻炮弹", "«滑膛炮» 炮弹", "导弹发射器 «九头蛇»", "导弹发射器 «浮士德»", "导弹发射器 «串联»", "超高速炮弹", "碎纸机", "猎人电子偶", "重型重炮手", "突击弹药库", "大口径颗粒", "电动炮塔", "致命混合物", "可持续纳米机器人", "导弹发射器 «流星»", "轰炸机", "左轮手枪", "破坏者", "注射冲击纳米机器人", "涅墨西斯", "凤凰（炮塔）"]
        };

function generateAllCombinations() {
    var allCombinations = [];
    Object.keys(groupedEquipments).forEach(function(group) {
        groupedEquipments[group].forEach(function(equipment) {
            Object.keys(groupedAugments).forEach(function(augmentGroup) {
                groupedAugments[augmentGroup].forEach(function(augment) {
                    allCombinations.push({ equipment, augment });
                });
            });
        });
    });
    displayAllCombinations(allCombinations);
}

// 显示所有组合
function generateAllCombinations() {
    var allCombinations = [];
    Object.keys(groupedEquipments).forEach(function(group) {
        groupedEquipments[group].forEach(function(equipment) {
            Object.keys(groupedAugments).forEach(function(augmentGroup) {
                groupedAugments[augmentGroup].forEach(function(augment) {
                    allCombinations.push({ equipment, augment });
                });
            });
        });
    });
    displayAllCombinations(allCombinations);
}

// 显示所有组合
function displayAllCombinations(allCombinations) {
    var loading = document.getElementById("loading");
    loading.style.display = "block";
    var combinedSVGs = [];
    var completed = 0;
    var progressBar = document.getElementById("progress-bar");
    var numColumns = groupedEquipments["炮塔"].length;  // 列数，装备的数量
    var numRows = groupedAugments["炮塔"].length;  // 行数，改造的数量
    var combinedWidth = 0;
    var combinedHeight = 0;

    // 创建一个表格
    var table = document.createElement("table");
    table.style.width = "100%";
    table.style.borderCollapse = "collapse";
    table.style.marginTop = "20px";
    var headerRow = table.insertRow();
    headerRow.innerHTML = "<th>改造 / 装备</th>";  // 表头，显示装备名称

    // 为表头添加装备列
    groupedEquipments["炮塔"].forEach(function(equipment) {
        var headerCell = document.createElement("th");
        headerCell.innerText = equipment;
        headerCell.style.border = "1px solid white";
        headerCell.style.padding = "8px";
        headerRow.appendChild(headerCell);
    });

    // 获取每个组合的SVG并填充表格
    groupedAugments["炮塔"].forEach(function(augment, rowIndex) {
        var row = table.insertRow();
        var firstCell = row.insertCell();
        firstCell.innerText = augment; // 显示改造名称
        firstCell.style.border = "1px solid white";
        firstCell.style.padding = "8px";
        firstCell.style.textAlign = "center";

        groupedEquipments["炮塔"].forEach(function(equipment, columnIndex) {
            var txtUrl = 'https://testanki1.github.io/augments_icon/equipments/' + encodeURIComponent(equipment) + '.txt';
            var svgUrl = 'https://testanki1.github.io/augments_icon/augments/' + encodeURIComponent(augment) + '.svg';
            var cell = row.insertCell();
            cell.style.border = "1px solid white";
            cell.style.padding = "8px";
            cell.style.textAlign = "center";
            
            fetch(txtUrl)
                .then(response => response.text())
                .then(txtContent => {
                    fetch(svgUrl)
                        .then(response => response.text())
                        .then(svgContent => {
                            var finalSVG = svgContent.slice(0, svgContent.indexOf('<defs>')) + txtContent + svgContent.slice(svgContent.indexOf('<defs>'));
                            var svgElement = new DOMParser().parseFromString(finalSVG, "application/xml").querySelector("svg");
                            var width = svgElement.getAttribute("width");
                            var height = svgElement.getAttribute("height");
                            combinedWidth = Math.max(combinedWidth, width);  // 计算表格的宽度
                            combinedHeight = Math.max(combinedHeight, height);  // 计算表格的高度

                            var svgImg = new Image();
                            svgImg.src = 'data:image/svg+xml;base64,' + btoa(finalSVG);
                            svgImg.style.width = "100%";
                            svgImg.style.height = "100%";
                            cell.appendChild(svgImg);
                        });
                });
        });
    });

    document.getElementById("svgContainer").appendChild(table);
    
    // 下载按钮部分
    var downloadBtn = document.getElementById("downloadBtn");
    downloadBtn.innerHTML = "<a href='data:image/svg+xml;base64," + btoa(generateTableSVG(table)) + "' download='combined_icons.svg'>下载拼接后的 SVG 图标</a>";
    downloadBtn.style.display = "block";
    
    loading.style.display = "none";
}

// 将表格转为SVG格式
function generateTableSVG(table) {
    var svgContent = "<svg xmlns='http://www.w3.org/2000/svg' width='100%' height='100%'>";
    var rows = table.rows;
    for (var r = 0; r < rows.length; r++) {
        var row = rows[r];
        for (var c = 0; c < row.cells.length; c++) {
            var cell = row.cells[c];
            svgContent += `<g transform="translate(${c * 120}, ${r * 120})">${cell.innerHTML}</g>`;
        }
    }
    svgContent += "</svg>";
    return svgContent;
}

</script>
