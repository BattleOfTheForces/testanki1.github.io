<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;500;700&display=swap" rel="stylesheet" />
<title>
	3D坦克排行榜
</title>
<style>
    * {
    font-family: 'Rubik', sans-serif;
    }
        * {
    -webkit-tap-highlight-color: transparent;
        }
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #001926; /* 背景颜色修改为 #001926 */
            color: white; /* 文字颜色修改为白色 */
        }
        h1 {
            text-align: center;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
        }
        .form-group input,
        .form-group select {
            width: 40ch;
            padding: 8px;
            margin-bottom: 10px;
            box-sizing: border-box;
            background-color: #001926; /* 背景颜色修改为 #001926 */
            color: white; /* 文字颜色修改为白色 */
        }
        .form-group button {
            width: 40ch;
            padding: 10px;
            margin-top: 10px;
            background-color: #76FF33; /* 按钮颜色修改为 #76FF33 */
            color: white; /* 文字颜色修改为白色 */
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .form-group button:hover {
            background-color: #59cc1d; /* 按钮悬停颜色修改为 #59cc1d */
        }
        #result {
            margin-top: 20px;
            width: 100%;
            overflow: auto;
            color: white; /* 文字颜色修改为白色 */
            text-align: center; /* 居中显示内容 */
        }
        #result pre {
            padding: 10px;
            overflow: auto;
            background-color: transparent; /* 去掉背景颜色 */
            color: white; /* 文字颜色修改为白色 */
            display: inline-block; /* 内容居中显示 */
            white-space: pre-wrap; /* 换行显示 */
        }
        /* 加载提示样式 */
        .loader {
            display: none;
            justify-content: center;
            align-items: center;
            height: 50px;
            width: 100%; 
            background-color: #001926;
            position: relative;
            margin-top: 10px;
        }
        .loader .loader-inner {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 4px solid #5C6C74;
            position: relative;
        }
        .loader .loader-inner:before {
            content: "";
            display: block;
            width: 100%;
            height: 100%;
            position: absolute;
            border-radius: 50%;
            border: 4px solid #fefefe;
            border-color: #fefefe transparent transparent transparent;
            animation: load infinite 1s linear;
        }
        @keyframes load {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
<h1>
	3D坦克排行榜
</h1>
<div class="form-group">
	<label for="region" style="text-align:center;">选择服务器：</label> 
	<div style="text-align:center;">
		<select id="region"> <option value="国服">国服</option>
                <option value="外服">外服</option>
            </select> 
	</div>
</div>
<div class="form-group">
	<label for="username" style="text-align:center;">输入昵称：</label> 
	<div style="text-align:center;">
		<input type="text" id="username" placeholder="请输入坦克昵称" /> 
	</div>
</div>
<div class="form-group" style="text-align:center;">
	<button id="fetchButton">确定</button> 
</div>
<div id="nameDisplay" style="color:white;text-align:center;margin-top:10px;">
</div>
<div id="rankDisplay" style="color:white;text-align:center;margin-top:10px;">
</div>
<div id="killsDisplay" style="color:white;text-align:center;margin-top:10px;">
</div>
<div id="deathsDisplay" style="color:white;text-align:center;margin-top:10px;">
</div>
<div id="kdrDisplay" style="color:white;text-align:center;margin-top:10px;">
	杀/死:
</div>
<div id="result">
	<!-- 个人资料将显示在这里 -->
</div>
<!-- 加载提示 -->
<div class="loader" id="loader">
	<div class="loader-inner">
	</div>
</div>
<script>
        document.getElementById('fetchButton').addEventListener('click', fetchProfile);
async function fetchProfile() {
    const region = document.getElementById('region').value;
    const username = document.getElementById('username').value;
    const resultDiv = document.getElementById('result');
    const nameDisplay = document.getElementById('nameDisplay');
    const rankDisplay = document.getElementById('rankDisplay');  // 获取显示等级的div
const killsDisplay = document.getElementById('killsDisplay'); // 确保 id 正确
const deathsDisplay = document.getElementById('deathsDisplay'); // 确保 id 正确
    const loader = document.getElementById('loader');
    resultDiv.innerHTML = '';  // 清空之前的结果
    nameDisplay.innerHTML = ''; // 清空名称显示区域
    rankDisplay.innerHTML = ''; // 清空军衔显示区域
    loader.style.display = 'flex'; // 显示加载提示
    if (username.trim() === '') {
        alert('请输入昵称');
        loader.style.display = 'none'; // 隐藏加载提示
        return;
    }
    let url;
    if (region === '国服') {
        url = `https://ratings.3dtank.com/get_stat/profile/?user=${username}&lang=cn`;
    } else if (region === '外服') {
        url = `https://ratings.tankionline.com/api/eu/profile/?user=${username}&lang=cn`;
    }
    const proxyUrl = 'https://api.allorigins.win/get?url=';
    const targetUrl = encodeURIComponent(url);
    const apiUrl = proxyUrl + targetUrl;
    // 等级名称映射表
    const ranks = [
        "新兵", "二等兵", "一等兵", "下士", "中士", "上士",
        "三级军士长", "二级军士长", "一级军士长", "军士长",
        "五级准尉", "四级准尉", "三级准尉", "二级准尉", "一级准尉", "特级准尉",
        "少尉", "中尉", "上尉", "少校", "中校", "上校",
        "准将", "少将", "中将", "上将", "元帅", "陆军元帅",
        "统帅", "大元帅", "传奇"
    ];
    try {
        const response = await fetch(apiUrl);
        if (!response.ok) {
            throw new Error('网络响应错误');
        }
        const data = await response.json();
        if (data && data.contents) {
            try {
                const responseData = JSON.parse(data.contents);
                if (responseData && responseData.responseType === 'NOT_FOUND') {
                    resultDiv.innerHTML = `
<p>
	找不到个人资料。请检查输入的昵称是否正确。
</p>
`;
                } else {
                    const formattedContent = JSON.stringify(responseData, null, 2)
            .replace(/s\.3dtank\.com\/[^"]*\.tnk/g, match => match.replace('s.3dtank.com', 'res.3dtank.com').replace('.tnk', '.webp'))
            .replace(/s\.eu.tankionline\.com\/[^"]*\.tnk/g, match => match.replace('s.eu.tankionline.com', 'res.3dtank.com').replace('.tnk', '.webp'));
                    resultDiv.innerHTML = `
<pre>${formattedContent}</pre>
`;
                    // 显示昵称
                    const name = responseData.response && responseData.response.name ? responseData.response.name : '未知昵称';
                    nameDisplay.innerHTML = `昵称: ${name}`;
                    // 显示等级
                    const rank = responseData.response && responseData.response.rank ? responseData.response.rank : 1; // 默认为新兵
                    const rankName = ranks[rank - 1] || '未知等级'; // 防止数组越界
                    rankDisplay.innerHTML = `等级: ${rankName}`;
const kills = responseData.response && responseData.response.kills ? responseData.response.kills : '无';
                    killsDisplay.innerHTML = `击杀: ${kills}`;
const deaths = responseData.response && responseData.response.deaths ? responseData.response.deaths : '无';
                    deathsDisplay.innerHTML = `死亡: ${deaths}`;
const kdr = deaths === 0 ? '-' : (kills / deaths).toFixed(2);
                    const kdrDisplay = document.getElementById('kdrDisplay');  // 获取显示杀/死率的div
                    kdrDisplay.innerHTML = `杀/死: ${kdr}`;
                }
                        } catch (error) {
                resultDiv.innerHTML = `
<p>
	无效 JSON 数据: ${error.message}
</p>
`;
            }
        } else {
            throw new Error('未知错误');
        }
    } catch (error) {
        resultDiv.innerHTML = `
<p>
	获取资料失败: ${error.message}
</p>
`;
    } finally {
        loader.style.display = 'none'; // 隐藏加载提示
    }
}
</script>
