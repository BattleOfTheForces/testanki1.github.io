<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>下载文本内容</title>
</head>
<body>
    <input type="text" id="text" style="width: 500px; height: 100px;">
    <button onclick="download()">下载</button>

    <script>
        function download() {
            const text = document.getElementById("text").value;
            const file = new File([text], "text.txt", {type: "text/plain"});

            // 使用上述代码将文件内容下载
            const files = [file];
            const zip = new JSZip();

            // 显示进度条
            progress.style.display = "block";

            // 初始化进度
            progressBar.value = 0;
            speedElement.textContent = "";
            remainingElement.textContent = "";

            // 创建下载任务
            const tasks = [];
            for (const file of files) {
                tasks.push(zip.file(file.name, file));
            }

            // 开始下载
            JSZip.external.Promise.all(tasks).then(function() {
                // 压缩完成

                // 计算下载速度
                const totalBytes = files.reduce((acc, file) => acc + file.size, 0);
                const downloadTime = Date.now() - startTime;
                const speed = Math.round(totalBytes / downloadTime * 1000) / 1000;

                // 显示下载完成信息
                speedElement.textContent = `${speed} KB/s`;
                remainingElement.textContent = "下载完成";

                // 生成 ZIP 压缩包
                zip.generateAsync({type: "blob"})
                    .then(function(content) {
                        const url = window.URL.createObjectURL(content);
                        const a = document.createElement("a");
                        a.href = url;
                        a.download = "download.zip";
                        a.click();
                    });
            }, function(error) {
                // 下载失败

                // 显示错误信息
                console.error(error);
                alert("下载失败！");
            });

            // 更新进度
            const startTime = Date.now();
            const updateProgress = () => {
                const totalBytes = files.reduce((acc, file) => acc + file.size, 0);
                const loadedBytes = zip.progress.loaded;
                const progress = Math.round(loadedBytes / totalBytes * 100);

                // 更新进度条
                progressBar.value = progress;

                // 计算剩余时间
                const remainingTime = Math.round((totalBytes - loadedBytes) / speed);
                remainingElement.textContent = `剩余时间：${remainingTime} 秒`;

                // 每秒更新一次进度
                setTimeout(updateProgress, 1000);
            };

            updateProgress();
        }
    </script>
</body>
</html>
